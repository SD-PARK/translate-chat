<html>
    <head>
        <meta charset="utf-8">
        <title>GitHub Commit Example</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    </head>
    <body>
        <div class="container">
            <h3>Socket.io Chat Example</h3>
            <form class="form-inline">
                <div class="form-group">
                    <label for="msgForm">Send: </label>
                    <input type="text" id="msgForm" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary">Send</button>
            </form>
            <div id="chatLogs"></div>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
            <script src="/socket.io/socket.io.js"></script>
            <script>
                const socket = io();
                const name = makeRandomName();

                // 접속 시 유저 정보를 서버에 전송
                socket.emit('login', {
                    name: name,
                    userid: name + '@gmail.com'
                });

                // 접속한 유저 정보를 서버에서 받아 출력
                socket.on('login', (name) => {
                    $('#chatLogs').append('<div>' + name + 'has joined</div>');
                });

                // Send 버튼 클릭 시
                $('form').submit((e) => {
                    e.preventDefault();
                    let $msgForm = $('#msgForm');

                    socket.emit('chat', $msgForm.val());
                    $msgForm.val('');
                });

                // 서버에서 채팅 메시지와 유저 네임을 받아와 출력
                socket.on('chat', (data) => {
                    $('#chatLogs').append('<div><strong>' + data.name + '</strong>: ' + data.msg + '</div>');
                });

                // 무작위 닉네임 생성(영문 3글자, 숫자 2글자)
                function makeRandomName() {
                    let name = '';
                    let possible = 'abcdefghijklmnopqrstuvwyz';
                    let possibleNum = '1234567890';

                    for(let i=0; i<3; i++)
                        name += possible.charAt(Math.floor(Math.random() * possible.length));
                    for(let i=0; i<3; i++)
                        name += possibleNum.charAt(Math.floor(Math.random() * possibleNum.length));
                    
                    return name;
                }
            </script>
        </div>
    </body>
</html>